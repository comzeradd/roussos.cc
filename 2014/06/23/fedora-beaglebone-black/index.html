<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>nikos.roussos &bull; Setup a home server with Fedora and BeagleBone Black</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="nikos.roussos">
    <meta property="og:site_name" content="nikos.roussos">
    
  <meta property="og:title" content="Setup a home server with Fedora and BeagleBone Black">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://www.roussos.cc/2014/06/23/fedora-beaglebone-black/">
  
    
      <meta property="og:image" content="https://www.roussos.cc/2014/06/23/fedora-beaglebone-black/beagle-fedora.png">
    
  
  <meta property="og:description" content="Over the last Free Software Meetup we discussed about the &#34;build your own home server&#34; movement. This is a long and complex discussion, so most likely it will expand to future meetups. In the meantime I wanted to test BeagleBone Black (BB), as the hardware platform for such a project. I prefer BB ov...">

    <link rel="stylesheet" href="/static/css/lib/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/lib/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/css/app.css">
    
    <link rel="shortcut icon" href="/favicon.ico">

  </head>

  <body>
    <div id="wrapper">

      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center">
            <p class="avatar">
              <a href="/">
                <img src="/static/img/me.jpg" alt="Nikos Roussos" class="avatar img-circle" />
              </a>
            </p>
            <h3 >
              <a href="/index.html">About</a> &bull;
              <a href="/blog.html">Blog</a> &bull;
              <a href="/projects.html">Projects</a> &bull;
              <a href="/music.html">Music</a> &bull;
              <a href="/places.html">Places</a> &bull;
              <a href="/contact.html">Contact</a>
            </h3>
          </div>
        </div>
      </div>

      
  <div class="container">
    <div class="row">
      <div class="col-md-12 post-title">
        <h3>
          <a href="/2014/06/23/fedora-beaglebone-black/">Setup a home server with Fedora and BeagleBone Black</a>
        </h3>
        <small>
          2014.06.23 -
          
            <a href="/tag/opensource/">#opensource</a>
          
            <a href="/tag/fedora/">#fedora</a>
          
            <a href="/tag/privacy/">#privacy</a>
          
        </small>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-12 post">
        <p>Over the last <a href="http://www.roussos.cc/2014/04/30/athens-free-software-monthly-meetups/">Free Software Meetup</a> we discussed about the "build your own home server" movement. This is a long and complex discussion, so most likely it will expand to future meetups. In the meantime I wanted to test BeagleBone Black (BB), as the hardware platform for such a project.</p>
<p><img src="/2014/06/23/fedora-beaglebone-black/beagle-fedora.png" alt="fedora on beaglebone black" class="txt" /> I prefer BB over Raspeberry Pi (RaPi) because, despite what many people seem to believe, RaPi <a href="http://en.wikipedia.org/wiki/Raspberry_Pi#Driver_API">is not</a> fully Open Hardware. I also prefer armv7 hardware, since it gives me the option to use a "regular" linux distribution. I have the option for Fedora or Debian instead of Pidora or Raspbian. </p>
<p>During the meetup we talked a lot about <a href="https://arkos.io/">Arkos</a>, which supports many arm boards and seems like a great choice for administering your home server through a well designed web interface, lowering the technical knowledge threshold for setting up services like file or mail server. I'll get back to Arkos, but at this point I wanted to experiment with a "regular" distribution. So this post is about Fedora and Beaglebone Black.</p>
<p>Download the <a href="http://fedoraproject.org/en/get-fedora#arm">Fedora ARM image</a> extract it and rename it to <code>fedora-arm.raw</code> so it's easier to follow the steps bellow.</p>
<p>Flashing Fedora to BB is not that difficult. The tricky part is that Fedora comes with an "initial setup" screen, which requires an hdmi monitor and a keyboard at least on first run so you can set some basic things (like root password). I wanted to do some modifications to the Fedora image, and get through this "initial setup" screen prior to flashing it on the BB. Inspired by <a href="http://ebalaskas.gr/blog/2013/03/25/raspberry-pi-with-archlinux-under-qemu/">Ebal's post</a>, I thought Qemu as a perfect tool for this job.</p>
<pre><code>sudo yum install qemu-system-arm
</code></pre>
<p>With qemu-system-arm tool I can emulate arm and run the image on my laptop. In order to boot the image qemu needs a kernel and what better place of finding a kernel than the image itself. You can either mount the image and copy kernel and initrd out or use libguestfs (kernel and Initrd version will obviously vary on future releases).</p>
<pre><code>sudo yum install -y libguestfs-tools
virt-copy-out -a fedora-arm.raw /boot/vmlinuz-3.11.10-301.fc20.armv7hl .
virt-copy-out -a fedora-arm.raw /boot/initramfs-3.11.10-301.fc20.armv7hl.img .
</code></pre>
<p>Finally run it. (you may have to add your user to kvm group)</p>
<pre><code>sudo usermod -aG kvm username
newgrp kvm
qemu-system-arm -machine vexpress-a9 -m 1024 -nographic -net nic -net user \
 -append "console=ttyAMA0,115200n8 rw root=/dev/mmcblk0p3 rootwait physmap.enabled=0" \
 -kernel vmlinuz-3.11.10-301.fc20.armv7hl \
 -initrd initramfs-3.11.10-301.fc20.armv7hl.img \
 -sd fedora-arm.raw
</code></pre>
<p>Booting up I reached to the "initial setup" screen I mentioned before. I created a new user with administrator (aka sudo) privileges. First things I did when finally got a prompt was to disable root account:</p>
<pre><code>sudo passwd -l root
</code></pre>
<p>set a hostname</p>
<pre><code>vi /etc/sysconfig/network
</code></pre>
<p>disable Network Manger</p>
<pre><code>systemctl disable NetworkManager.service
</code></pre>
<p>setup static networking</p>
<pre><code>echo "
 HWADDR="D8:D3:85:AE:DD:4C"
 BOOTPROTO="static"
 DEVICE="eth0"
 ONBOOT="yes"
 IPADDR=192.168.1.2
 NETMASK=255.255.255.0
 BROADCAST=192.168.1.255
 NETWORK=192.168.1.0
 GATEWAY=192.168.1.1
"&gt;/etc/sysconfig/network-scripts
</code></pre>
<p>add DNS settings</p>
<pre><code>echo "
 nameserver 208.67.222.222
 nameserver 208.67.222.222
"&gt;/etc/resolv.conf
</code></pre>
<p>disable selinux (<a href="http://stopdisablingselinux.com/">sorry Dan</a>)</p>
<pre><code>setenforce 0
sed -i s/=enforcing/=disabled/ /etc/selinux/config
</code></pre>
<p>Enable ssh</p>
<pre><code>systemctl enable sshd
firewall-cmd --permanent --zone=public --add-service=ssh
</code></pre>
<p>Fedora image is around 2G. I had a 4G SDcard so I expanded it by 2G</p>
<pre><code>qemu-img resize fedora-arm.raw +2G
</code></pre>
<p>Important to remember that this will expand the image but not the root filesystem inside. Flash it to an SDcard</p>
<pre><code>dd if=fedora-arm.raw of=/dev/sdX
</code></pre>
<p>This a destructive command so make sure that sdX refers to your SDcard and not some disk. Now mount the card and resize the root filesystem, that probably would be on sdX3</p>
<pre><code>e2fsck -f /dev/sdX3
resize2fs /dev/sdX3
</code></pre>
<p>And that's all. I removed the mini sd from the adapter and inserted it on BB. All that's left is ethernet connection and power. Less than a minute later I was able to ssh to my soon-to-be home server from my laptop.</p>

        <div class="post-share">
          Share:
          <a href="https://sharetodiaspora.github.io/?title=Setup a home server with Fedora and BeagleBone Black&amp;url=https://www.roussos.cc/2014/06/23/fedora-beaglebone-black/" target="_blank">
            <img src="https://sharetodiaspora.github.io/favicon.png" alt="diaspora*"> diaspora*
          </a>
        </div>
      </div>
    </div>
  </div>





    </div>

    <div id="footer" >
      <div class="container">
        powered by <a href="https://github.com/comzeradd/monopati" target="_blank">monopati</a> &bull;
       <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution-ShareAlike</a>
      </div>
    </div>

    <script src="/static/js/lib/jquery-1.11.2.min.js"></script>
    <script src="/static/js/lib/bootstrap.min.js"></script>
    
    
  </body>
</html>